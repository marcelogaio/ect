/*!
 * ECT CoffeeScript template engine v0.5.9
 * https://github.com/baryshev/ect
 *
 * Copyright 2012-2014, Vadim M. Baryshev <vadimbaryshev@gmail.com>
 * Licensed under the MIT license
 * https://github.com/baryshev/ect/LICENSE
 *
 * Includes parts of node
 * https://github.com/joyent/node
 * Copyright Joyent, Inc. and other Node contributors
 * Released under the MIT license
 *
 * Includes Cross-Browser Split 1.1.1
 * http://xregexp.com/
 * Copyright 2007-2012 Steven Levithan <stevenlevithan.com>
 * Released under the MIT license
 */
!function(){"use strict";var fs,path,CoffeeScript,ECT=function(options){if(!(this instanceof ECT))return new ECT(options);this.options={open:"<%",close:"%>",ext:"",cache:!0,watch:!1,root:""};var ect=this,trimExp=/^[ \t]+|[ \t]+$/g,newlineExp=/\n/g,cache={},watchers={},indentChars={":":":",">":">"},escapeExp=/[&<>"]/,escapeAmpExp=/&/g,escapeLtExp=/</g,escapeGtExp=/>/g,escapeQuotExp=/"/g,regExpEscape=function(e){return String(e).replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},read=function(e){if("[object Object]"===Object.prototype.toString.call(ect.options.root)){var t=e.split(".").reduce(function(e,t){return e[t]},ect.options.root);if("[object String]"===Object.prototype.toString.call(t))return t;throw new Error("Failed to load template "+e)}try{return fs.readFileSync(e,"utf8")}catch(n){throw new Error("Failed to load template "+e)}},compile=function(template){for(var lineNo=1,bufferStack=["__ectOutput"],bufferStackPointer=0,buffer=bufferStack[bufferStackPointer]+" = '",matches=template.split(new RegExp(regExpEscape(ect.options.open)+"((?:.|[\r\n])+?)(?:"+regExpEscape(ect.options.close)+"|$)")),output,text,command,line,prefix,postfix,newline,indentChar,indentation="",indent=!1,indentStack=[],indentStackPointer=-1,baseIndent,lines,j,i=0;i<matches.length;i++){if(text=matches[i],command="",i%2===1){switch(line="__ectFileInfo.line = "+lineNo,text.charAt(0)){case"=":prefix="' + ("+line+"\n'') + __ectTemplateContext.escape(",postfix=") + '",newline="",text=text.substr(1),output="escaped";break;case"-":prefix="' + ("+line+"\n'') + ((",postfix=") ? '') + '",newline="",text=text.substr(1),output="unescaped";break;default:prefix="'\n"+line,postfix="\n"+bufferStack[bufferStackPointer]+" += '",newline="\n",output="none"}switch(text=text.replace(trimExp,""),command=text.split(/[^a-z]+/)[0],(indentChar=indentChars[text.charAt(text.length-1)])&&(text=text.replace(/:$/,"").replace(trimExp,""),">"===indentChar&&(/[$a-z_][0-9a-z_$]*[^=]+(-|=)>/i.test(text.replace(/'.*'|".*"/,""))&&(indentStack.push("capture_output_"+output),indentStackPointer++),bufferStack.push("__ectFunction"+bufferStackPointer),bufferStackPointer++,postfix="\n"+bufferStack[bufferStackPointer]+" = '",command="function"),indentStack.push(command),indentStackPointer++,indent=!0),command){case"include":"none"===output&&(prefix="' + ("+line+"\n'') + (",postfix=") + '"),buffer+=prefix.replace(newlineExp,"\n"+indentation)+text+postfix.replace(newlineExp,"\n"+indentation);break;case"block":bufferStack.push("__ectTemplateContext.blocks['"+text.replace(/block\s+('|")([^'"]+)('|").*/,"$2")+"']"),bufferStackPointer++,prefix="'\n",postfix="\n"+bufferStack[bufferStackPointer]+" += '",text="if "+text,buffer+=prefix.replace(newlineExp,"\n"+indentation)+text,indent&&(indentation+="  ",indent=!1),buffer+=postfix.replace(newlineExp,"\n"+indentation);break;case"content":"none"===output&&(prefix="' + ("+line+"\n'') + (",postfix=") + '"),"content"===text&&(text="content()"),buffer+=prefix.replace(newlineExp,"\n"+indentation)+text+postfix.replace(newlineExp,"\n"+indentation);break;case"end":switch(prefix="'",indentStack[indentStackPointer]){case"block":bufferStack.pop(),bufferStackPointer--,prefix="'",postfix="\n"+bufferStack[bufferStackPointer]+" += '",buffer+=prefix.replace(newlineExp,"\n"+indentation),indentation=indentation.substr(2),buffer+=postfix.replace(newlineExp,"\n"+indentation);break;case"when":postfix="\n"+bufferStack[bufferStackPointer]+" += ''",buffer+=prefix.replace(newlineExp,"\n"+indentation)+postfix.replace(newlineExp,"\n"+indentation),indentation=indentation.substr(2);break;case"function":switch(prefix="'\n"+bufferStack[bufferStackPointer],buffer+=prefix.replace(newlineExp,"\n"+indentation),indentation=indentation.substr(2),bufferStack.pop(),bufferStackPointer--,postfix="\n"+bufferStack[bufferStackPointer]+" += '",indentStack[indentStackPointer-1]){case"capture_output_escaped":indentStack.pop(),indentStackPointer--,buffer+=")";break;case"capture_output_unescaped":indentStack.pop(),indentStackPointer--,buffer+=") ? '')";break;case"capture_output_none":indentStack.pop(),indentStackPointer--}buffer+=postfix.replace(newlineExp,"\n"+indentation);break;case"switch":prefix="\n"+line;default:"switch"===indentStack[indentStackPointer-1]&&(postfix=""),indentation=indentation.substr(2),buffer+=prefix.replace(newlineExp,"\n"+indentation)+postfix.replace(newlineExp,"\n"+indentation)}indentStack.pop(),indentStackPointer--;break;case"else":prefix="switch"===indentStack[indentStackPointer-1]?"":"'",buffer+=prefix.replace(newlineExp,"\n"+indentation),("if"===indentStack[indentStackPointer-1]||"else"===indentStack[indentStackPointer-1]||"unless"===indentStack[indentStackPointer-1])&&(indentStack.splice(-2,1),indentStackPointer--,indentation=indentation.substr(2)),buffer+=(newline.length?newline+indentation:"")+text,indent&&(indentation+="  ",indent=!1),buffer+=postfix.replace(newlineExp,"\n"+indentation);break;case"switch":buffer+=prefix.replace(newlineExp,"\n"+indentation)+(newline.length?newline+indentation:"")+text,indent&&(indentation+="  ",indent=!1);break;case"when":buffer+=(newline.length?newline+indentation:"")+text,indent&&(indentation+="  ",indent=!1),buffer+=postfix.replace(newlineExp,"\n"+indentation);break;case"extend":text="__ectExtended = true\n__ectParent = "+text.replace(/extend\s+/,"");default:if(/\n/.test(text)){for(lines=text.split(/\n/),buffer+=prefix.replace(newlineExp,"\n"+indentation),j=0;j<lines.length;j++)/^\s*$/.test(lines[j])||("undefined"==typeof baseIndent&&(baseIndent=new RegExp("^"+lines[j].substr(0,lines[j].search(/[^\s]/)))),buffer+=(newline.length?newline+indentation:"")+lines[j].replace(baseIndent,""));lines=void 0,baseIndent=void 0}else buffer+=prefix.replace(newlineExp,"\n"+indentation)+(newline.length?newline+indentation:"")+text;indent&&(indentation+="  ",indent=!1),buffer+=postfix.replace(newlineExp,"\n"+indentation)}}else"switch"!==indentStack[indentStackPointer]&&(buffer+=text.replace(/[\\']/g,"\\$&").replace(/\r/g,"").replace(newlineExp,"\\n").replace(/^\\n/,""));lineNo+=text.split(newlineExp).length-1}return buffer+="'\nif not __ectExtended\n  return __ectOutput\nelse\n  __ectContainer = __ectTemplateContext.load __ectParent\n  __ectFileInfo.file = __ectContainer.file\n  __ectFileInfo.line = 1\n  __ectTemplateContext.childContent = __ectOutput\n  return __ectContainer.compiled.call(this, __ectTemplateContext, __ectFileInfo, include, content, block)",buffer="__ectExtended = false\n"+buffer,eval("(function __ectTemplate(__ectTemplateContext, __ectFileInfo, include, content, block) {\n"+CoffeeScript.compile(buffer,{bare:!0})+"});")},TemplateContext=function(e){this.blocks={},this.data=e||{},this.childContent=""};TemplateContext.prototype.escape=function(e){if(null==e)return"";var t=e.toString();return escapeExp.test(t)?t.replace(escapeAmpExp,"&#38;").replace(escapeLtExp,"&#60;").replace(escapeGtExp,"&#62;").replace(escapeQuotExp,"&#34;"):t},TemplateContext.prototype.block=function(e){return this.blocks[e]||(this.blocks[e]=""),!this.blocks[e].length},TemplateContext.prototype.content=function(e){return e&&e.length?this.blocks[e]?this.blocks[e]:"":this.childContent},TemplateContext.prototype.load=function(template){var file,compiled,container,data;if(ect.options.cache&&cache[template])return cache[template];var extExp=new RegExp(regExpEscape(ect.options.ext)+"$");if(file="[object String]"===Object.prototype.toString.call(ect.options.root)?"undefined"!=typeof process&&"win32"===process.platform?path.normalize((ect.options.root.length&&"/"!==template.charAt(0)&&"\\"!==template.charAt(0)&&!/^[a-zA-Z]:/.test(template)?ect.options.root+"/":"")+template):path.normalize((ect.options.root.length&&"/"!==template.charAt(0)?ect.options.root+"/":"")+template):template,data=read(file),"(function __ectTemplate("===data.substr(0,24))try{compiled=eval(data)}catch(e){throw e.message=e.message+" in "+file,e}else try{compiled=compile(data)}catch(e){throw e.message=e.message.replace(/ on line \d+/,"")+" in "+file,e}return container={file:file,compiled:compiled,source:"("+compiled.toString()+");",lastModified:(new Date).toUTCString(),gzip:null},ect.options.cache&&(cache[template]=container,ect.options.watch&&"undefined"==typeof watchers[file]&&(watchers[file]=fs.watch(file,{persistent:!1},function(){watchers[file].close(),delete watchers[file],delete cache[template]}))),container},TemplateContext.prototype.render=function(e,t){var n=this,i=this.load(e),r={file:i.file,line:1};try{return i.compiled.call(t||this.data,this,r,function(){return n.render.apply(n,arguments)},function(){return n.content.apply(n,arguments)},function(){return n.block.apply(n,arguments)})}catch(o){throw/ in /.test(o.message)||(o.message=o.message+" in "+r.file+" on line "+r.line),o}},this.configure=function(e){e=e||{};for(var t in e)this.options[t]=e[t]},this.compile=function(e){var t;try{return t=compile(e)}catch(n){throw n.message=n.message.replace(/ on line \d+/,""),n}},this.render=function(e,t,n){var i;if("function"!=typeof arguments[arguments.length-1])return i=new TemplateContext(t),i.render(e);2===arguments.length&&(n=t,t={}),i=new TemplateContext(t);try{n(void 0,i.render(e))}catch(r){n(r)}},this.clearCache=function(e){e?delete cache[e]:cache={}},"undefined"!=typeof module&&module.exports&&(this.compiler=function(e){var t=require("zlib");e=e||{},e.root=e.root||"/",e.root="/"+e.root.replace(/^\//,""),e.root=e.root.replace(/\/$/,"")+"/";var n=new RegExp("^"+regExpEscape(e.root));return function(i,r,o){if("GET"!==i.method&&"HEAD"!==i.method)return o();if(e.root&&i.url.substr(0,e.root.length)!==e.root)o();else{var a=i.url.replace(n,"");try{var c=new TemplateContext,p=c.load(a);r.setHeader("Content-Type","application/x-javascript; charset=utf-8"),r.setHeader("Last-Modified",p.lastModified),e.gzip?(r.setHeader("Content-Encoding","gzip"),null===p.gzip?t.gzip(p.source,function(e,t){e?o(e):(p.gzip=t,r.end(p.gzip))}):r.end(p.gzip)):(r.setHeader("Content-Length","undefined"!=typeof Buffer?Buffer.byteLength(p.source,"utf8"):p.source.length),r.end(p.source))}catch(l){o(l)}}}}),this.configure(options)};if("undefined"!=typeof module&&module.exports)fs=require("fs"),path=require("path"),"function"==typeof define&&define.amd?define("ect",["coffee-script"],function(e){return CoffeeScript=e,ECT}):(CoffeeScript=require("coffee-script"),module.exports=ECT);else{Array.prototype.filter||(Array.prototype.filter=function(e,t){var n,i,r=this.length>>0,o=[];if("function"!=typeof e)throw new TypeError;for(n=0;r>n;n++)n in this&&(i=this[n],e.call(t,i,n,this)&&o.push(i));return o}),Array.prototype.reduce||(Array.prototype.reduce=function(e){if(null===this||void 0===this)throw new TypeError("Object is null or undefined");var t,n=0,i=this.length>>0;if("function"!=typeof e)throw new TypeError("First argument is not callable");if(arguments.length<2){if(0===i)throw new TypeError("Array length is 0 and no second argument");t=this[0],n=1}else t=arguments[1];for(;i>n;)n in this&&(t=e.call(void 0,t,this[n],n,this)),++n;return t});var split;split=split||function(e){var t,n=String.prototype.split,i=/()??/.exec("")[1]===e;return t=function(t,r,o){if("[object RegExp]"!==Object.prototype.toString.call(r))return n.call(t,r,o);var a,c,p,l,f=[],s=(r.ignoreCase?"i":"")+(r.multiline?"m":"")+(r.extended?"x":"")+(r.sticky?"y":""),u=0,r=new RegExp(r.source,s+"g");for(t+="",i||(a=new RegExp("^"+r.source+"$(?!\\s)",s)),o=o===e?-1>>>0:o>>>0;(c=r.exec(t))&&(p=c.index+c[0].length,!(p>u&&(f.push(t.slice(u,c.index)),!i&&c.length>1&&c[0].replace(a,function(){for(var t=1;t<arguments.length-2;t++)arguments[t]===e&&(c[t]=e)}),c.length>1&&c.index<t.length&&Array.prototype.push.apply(f,c.slice(1)),l=c[0].length,u=p,f.length>=o)));)r.lastIndex===c.index&&r.lastIndex++;return u===t.length?(l||!r.test(""))&&f.push(""):f.push(t.slice(u)),f.length>o?f.slice(0,o):f},String.prototype.split=function(e,n){return t(this,e,n)},t}(),"function"==typeof define&&define.amd?define("ect",["coffee-script"],function(e){return CoffeeScript=e,ECT}):(CoffeeScript=window.CoffeeScript,window.ECT=ECT),path=function(){var e=function(e,t){var n,i,r=0;for(n=e.length-1;n>=0;n--)i=e[n],"."===i?e.splice(n,1):".."===i?(e.splice(n,1),r++):r&&(e.splice(n,1),r--);if(t)for(;r;)e.unshift(".."),r--;return e},t=function(t){var n="/"===t.charAt(0),i="/"===t.slice(-1);return t=e(t.split("/").filter(function(e){return!!e}),!n).join("/"),t||n||(t="."),t&&i&&(t+="/"),(n?"/":"")+t};return{normalize:t}}(),fs=function(){var e=function(e,t){var n;if(window.XMLHttpRequest?(n=new XMLHttpRequest,n.overrideMimeType&&n.overrideMimeType("text/html")):n=new ActiveXObject("Microsoft.XMLHTTP"),n){if(n.open("GET",e,!1),n.send(null),0!==n.status&&(n.status<200||n.status>399))throw new Error("Failed to load template "+e);return n.responseText}throw new Error("Failed to load template "+e)},t=function(){};return{readFileSync:e,watch:t}}()}}();
//# sourceMappingURL=../ect.min.map
